{% extends "base.html" %}

{% block content %}
  <main id="gravimetry_graphs_container" class="grav_graph">
    <div class="gravimetry_graph_control">
        <h3>Parameters</h3>
	<div class="axis-params">
	    <h4>Axis</h4>
	    <div class="graph_axis_container">
	        <div class="graph_param">
	          <label for="x-axis">X</label>
		  <select id="x-axis-param" name="x-axis">
		      {% for opt in xopts %}
		      <option value="{{ opt[0] }}">{{ opt[1] }}</option>
		      {% endfor %}
		  </select> 	
	        </div>
	      <div class="graph_param">
		  <label for="y-axis">Y</label>
	          <select id="y-axis-param" name="y-axis">
		      {% for opt in yopts %}
		      <option value="{{ opt[0] }}">{{ opt[1] }}</option>
		      {% endfor %}
		  </select> 	
	      </div>
	    </div>
	</div>
	<div class="graph-params">
	    <h4>Eye Candy</h4>

	</div>
	<div class="graph-control">
	    <h4>Control</h4>
	    <div class="graph-sliders-container">
	        {% for s in residual_anom_control %}
	        <div class='graph-slider'>
		    <label for="{{ s[1] }}">{{ s[0] }}</label><br>
		    <input type="range" min="0" max="100" 
		           value="50" id="{{ s[1] }}-slider" 
		           step="1" oninput="updateSlider(value, this)">
		    <output for="{{ s[1] }}" id="{{ s[1] }}-output">50</output></br>
	        </div>
	        {% endfor %}
	    </div>
	</div>
    </div>
    <div id="gravimetry_graph_root" class="d3_graph svg-container"></div>
  </main>
	<script>
	data = Object.assign({}, JSON.parse(JSON.parse(localStorage.getItem('gravimetry_json'))))
	
	var chart = new Graph({
    		element: document.getElementById('gravimetry_graph_root'),
		originalData: data,
		data: { x: data.stations, y: data.residual_anom }
	});

	var xSelectBox = document.getElementById('x-axis-param')
	var ySelectBox = document.getElementById("y-axis-param")
	xSelectBox.value = 'stations'
	ySelectBox.value = 'residual_anom'

	xSelectBox.addEventListener('change', () => {
		chart.setData({ 
			x: chart.getData()[xSelectBox.value], 
			y: chart.getData()[ySelectBox.value] 
		})
	})

	ySelectBox.addEventListener('change', () => {
		chart.setData({ 
			x: chart.getData()[xSelectBox.value], 
			y: chart.getData()[ySelectBox.value] 
		})
	})

	let updateSlider = (newValue, self) => {
		const sliderId = self.id.split('-')[0]
		const outputSlider = document.getElementById(sliderId + '-output')
		self.value = newValue;
		outputSlider.innerHTML = newValue
	}
  </script>
{% endblock %}
